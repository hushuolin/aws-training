{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Resources": {
      "DynamoDBTable": {
        "Type": "AWS::DynamoDB::Table",
        "Properties": {
          "TableName": "KinesisDataTable",
          "AttributeDefinitions": [
            { "AttributeName": "id", "AttributeType": "S" }
          ],
          "KeySchema": [
            { "AttributeName": "id", "KeyType": "HASH" }
          ],
          "BillingMode": "PAY_PER_REQUEST"
        }
      },
      "KinesisStream": {
        "Type": "AWS::Kinesis::Stream",
        "Properties": {
          "Name": "KinesisDataStream",
          "ShardCount": 1
        }
      },
      "LambdaExecutionRole": {
        "Type": "AWS::IAM::Role",
        "Properties": {
          "AssumeRolePolicyDocument": {
            "Version": "2012-10-17",
            "Statement": [
              {
                "Effect": "Allow",
                "Principal": { "Service": "lambda.amazonaws.com" },
                "Action": "sts:AssumeRole"
              }
            ]
          },
          "Policies": [
            {
              "PolicyName": "LambdaDynamoDBPolicy",
              "PolicyDocument": {
                "Statement": [
                  {
                    "Effect": "Allow",
                    "Action": [
                      "dynamodb:PutItem",
                      "kinesis:GetRecords",
                      "kinesis:GetShardIterator",
                      "kinesis:DescribeStream",
                      "logs:CreateLogGroup",
                      "logs:CreateLogStream",
                      "logs:PutLogEvents"
                    ],
                    "Resource": "*"
                  }
                ]
              }
            }
          ]
        }
      }
    }
  }
  